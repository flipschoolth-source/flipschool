<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Mission Designer ‚ú® - FlipSchool</title>

    <link rel="icon" type="image/png" href="img/favicon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;500;600&family=Sarabun&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary:#00008B;
            --primary-light:#0052D4;
            --ai:#8e44ad;
            --bg:#f0f2f5;
        }
        body {
            margin:0;
            font-family:'Sarabun',sans-serif;
            background:var(--bg);
        }
        header {
            background:linear-gradient(135deg,#000046,var(--primary-light));
            color:#fff;
            text-align:center;
            padding:40px 20px;
            border-radius:0 0 40px 40px;
        }
        main {
            max-width:1200px;
            margin:-30px auto 40px;
            padding:0 20px;
            display:grid;
            grid-template-columns:1fr 380px;
            gap:25px;
        }
        @media(max-width:1024px){
            main{grid-template-columns:1fr;}
        }
        .card {
            background:#fff;
            border-radius:25px;
            padding:25px;
            box-shadow:0 10px 30px rgba(0,0,0,.05);
            margin-bottom:20px;
        }
        textarea,input {
            width:100%;
            box-sizing:border-box;
            padding:12px;
            border-radius:12px;
            border:1px solid #ddd;
            font-family:inherit;
        }
        button {
            cursor:pointer;
            border:none;
            border-radius:12px;
            padding:12px;
            font-family:'Kanit';
        }
        .btn-main {
            background:var(--ai);
            color:#fff;
            width:100%;
            margin-top:10px;
        }
        .status {
            display:flex;
            align-items:center;
            gap:8px;
            font-size:13px;
            font-weight:600;
            color:#7f8c8d;
        }
        .dot {
            width:10px;
            height:10px;
            border-radius:50%;
            background:#bbb;
        }
        .dot.on {
            background:#2ecc71;
            box-shadow:0 0 6px #2ecc71;
        }
        .phone {
            background:#111;
            border-radius:40px;
            padding:12px;
            height:600px;
            position:sticky;
            top:20px;
        }
        .screen {
            background:#fff;
            border-radius:30px;
            height:100%;
            display:flex;
            align-items:center;
            justify-content:center;
            text-align:center;
            padding:20px;
        }
        pre {
            background:#fafafa;
            padding:15px;
            border-radius:12px;
            overflow:auto;
            font-size:12px;
        }
    </style>
</head>

<body>

<header>
    <h1 style="font-family:Kanit;margin:0;">AI Mission Designer üöÄ</h1>
    <p>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏î‡πâ‡∏ß‡∏¢ Gemini AI</p>
</header>

<main>

    <!-- LEFT -->
    <section>

        <div class="card">
            <div class="status">
                <div id="dot" class="dot"></div>
                <span id="statusText">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API</span>
            </div>

            <label style="margin-top:15px;display:block;font-weight:600;">üîë Gemini API Key</label>
            <input type="password" id="geminiKey" placeholder="‡∏ß‡∏≤‡∏á API Key ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà">
            <button class="btn-main" onclick="testApiKey()">*Test API Key</button>
        </div>

        <div class="card">
            <label style="font-family:Kanit;font-weight:500;">üí° ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</label>
            <textarea id="aiPrompt" rows="3" placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å 5 ‡∏ä‡∏ô‡∏¥‡∏î ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°"></textarea>
            <button class="btn-main" onclick="generateByAI()">‚ú® ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏î‡πâ‡∏ß‡∏¢ AI</button>
        </div>

        <div class="card">
            <label style="font-family:Kanit;font-weight:500;">üì¶ JSON Output</label>
            <div id="dataEditor">
                <p style="color:#aaa;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
            </div>
        </div>

    </section>

    <!-- RIGHT -->
    <aside>
        <div class="phone">
            <div class="screen" id="preview">
                <p style="color:#aaa;">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‚Ä¶</p>
            </div>
        </div>
    </aside>

</main>

<script>
const MODEL = "gemini-1.5-pro";

document.addEventListener("DOMContentLoaded",()=>{
    const saved = localStorage.getItem("gemini_api_key");
    if(saved){
        document.getElementById("geminiKey").value = saved;
    }
});

async function testApiKey(){
    const key = geminiKey.value;
    if(!key) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà API Key");

    try{
        const res = await fetch(
            `https://generativelanguage.googleapis.com/v1/models/${MODEL}:generateContent?key=${key}`,
            {
                method:"POST",
                headers:{ "Content-Type":"application/json" },
                body:JSON.stringify({
                    contents:[{parts:[{text:"ping"}]}]
                })
            }
        );
        const json = await res.json();
        if(json.error) throw new Error(json.error.message);

        dot.classList.add("on");
        statusText.textContent = "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Gemini API ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
        localStorage.setItem("gemini_api_key",key);
        alert("‚úÖ API Key ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ");

    }catch(e){
        dot.classList.remove("on");
        statusText.textContent = "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
        alert("‚ùå "+e.message);
    }
}

async function generateByAI(){
    const key = geminiKey.value;
    const prompt = aiPrompt.value;
    if(!key || !prompt) return alert("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö");

    const instruction = `
‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô JSON ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏´‡πâ‡∏≤‡∏°‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏∑‡πà‡∏ô
‡∏™‡∏£‡πâ‡∏≤‡∏á Quiz 3 ‡∏Ç‡πâ‡∏≠ ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á "${prompt}"
‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:
[
 { "q":"‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°","ok":"‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å","no":"‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î" }
]
`;

    try{
        const res = await fetch(
            `https://generativelanguage.googleapis.com/v1/models/${MODEL}:generateContent?key=${key}`,
            {
                method:"POST",
                headers:{ "Content-Type":"application/json" },
                body:JSON.stringify({
                    contents:[{parts:[{text:instruction}]}]
                })
            }
        );
        const json = await res.json();
        if(json.error) throw new Error(json.error.message);

        let text = json.candidates[0].content.parts[0].text;
        text = text.replace(/```json|```/g,"").trim();

        const data = JSON.parse(text);
        dataEditor.innerHTML = `<pre>${JSON.stringify(data,null,2)}</pre>`;

        preview.innerHTML = `
            <h3>${data[0].q}</h3>
            <button style="width:100%;margin-top:10px">${data[0].ok}</button>
        `;

    }catch(e){
        alert("‚ùå "+e.message);
    }
}
</script>

</body>
</html>

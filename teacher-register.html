<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>ระบบค้นหาโรงเรียน (Mock Data)</title>
    <style>
        body { font-family: 'Sarabun', sans-serif; padding: 20px; background: #f4f4f4; }
        
        /* สไตล์กล่องค้นหาแบบ Autocomplete */
        .search-container {
            position: relative;
            width: 100%;
            max-width: 500px;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        /* รายการผลลัพธ์ที่จะเด้งขึ้นมา */
        #schoolList {
            position: absolute;
            z-index: 1000;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ccc;
            border-top: none;
            max-height: 200px;
            overflow-y: auto;
            display: none; /* ซ่อนไว้ก่อน */
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        #schoolList div {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }

        #schoolList div:hover {
            background-color: #e9ecef;
        }

        /* กล่องแสดงสถานะ (Debug) */
        .debug-box {
            margin-top: 10px;
            padding: 10px;
            background: #fff3cd;
            border: 1px solid #ffeeba;
            font-size: 14px;
            color: #856404;
        }
    </style>
</head>
<body>

    <h3>เลือกโรงเรียนสังกัด</h3>
    
    <div class="search-container">
        <input type="text" id="schoolInput" placeholder="พิมพ์ชื่อโรงเรียนเพื่อค้นหา..." autocomplete="off">
        
        <div id="schoolList"></div>

        <input type="hidden" id="schoolIdHidden" name="school_id">
    </div>

    <div class="debug-box" id="debugStatus">
        สถานะ: ยังไม่ได้เลือกโรงเรียน <br>
        (ค่าที่จะส่งเข้า SQL: <span id="sqlValue">-</span>)
    </div>

<script>
    // จำลองข้อมูลจาก Database (ในของจริง Python จะเป็นคนส่งมาให้)
    const schoolsDB = [
        { id: 'SC001', name: 'โรงเรียนบ้านหนองฮี', province: 'ขอนแก่น' },
        { id: 'SC002', name: 'โรงเรียนสตรีวิทยา', province: 'กรุงเทพฯ' },
        { id: 'SC003', name: 'โรงเรียนหาดใหญ่วิทยาลัย', province: 'สงขลา' },
        { id: 'SC004', name: 'โรงเรียนยุพราชวิทยาลัย', province: 'เชียงใหม่' },
        { id: 'SC005', name: 'โรงเรียนอนุบาลสงขลา', province: 'สงขลา' }
    ];

    const input = document.getElementById("schoolInput");
    const list = document.getElementById("schoolList");
    const hiddenId = document.getElementById("schoolIdHidden");
    const debugText = document.getElementById("sqlValue");
    const debugBox = document.getElementById("debugStatus");

    // เมื่อพิมพ์ในช่องค้นหา
    input.addEventListener("input", function() {
        const val = this.value.toLowerCase();
        
        // ถ้าช่องว่าง ให้ปิดรายการและเคลียร์ค่า
        if (!val) {
            list.style.display = "none";
            hiddenId.value = "";
            debugText.innerText = "-";
            return;
        }

        // กรองข้อมูล (Search Logic)
        const matches = schoolsDB.filter(school => 
            school.name.toLowerCase().includes(val) || 
            school.province.toLowerCase().includes(val)
        );

        // แสดงผล
        list.innerHTML = "";
        if (matches.length > 0) {
            list.style.display = "block";
            matches.forEach(school => {
                const item = document.createElement("div");
                // แสดงชื่อโรงเรียน และ จังหวัด
                item.innerHTML = `<strong>${school.name}</strong> <small>(${school.province})</small>`;
                
                // เมื่อคลิกเลือกโรงเรียน
                item.addEventListener("click", function() {
                    // 1. ใส่ชื่อในช่องให้คนเห็น
                    input.value = school.name;
                    // 2. แอบใส่ ID ลงในช่องลับ (เพื่อเตรียมส่ง SQL)
                    hiddenId.value = school.id;
                    // 3. ปิดรายการ
                    list.style.display = "none";
                    
                    // อัปเดต Debug
                    debugText.innerText = school.id;
                    debugBox.innerHTML = `✅ เลือกแล้ว: <b>${school.name}</b><br>(School ID: ${school.id})`;
                    debugBox.style.backgroundColor = "#d4edda";
                    debugBox.style.borderColor = "#c3e6cb";
                    debugBox.style.color = "#155724";
                });
                list.appendChild(item);
            });
        } else {
            list.style.display = "none";
        }
    });

    // คลิกที่อื่นเพื่อปิดรายการ
    document.addEventListener("click", function(e) {
        if (e.target !== input) {
            list.style.display = "none";
        }
    });
</script>

</body>
</html>
